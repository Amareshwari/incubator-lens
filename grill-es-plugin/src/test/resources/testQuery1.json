{
     "query" : {
            "match_all" : { }  
     },
     
     "size": 1000,    
        
    "facets": {
     "cube_facet": {
       "script": {
        "map_script": "cube_map",
        "combine_script": "cube_combiner",
        "reduce_script": "cube_reduce",
        "lang": "native",
        
        "params": {
            "groupby": ["dim1", "col1"],

            "aggregates": [                   
                { "name": "sum", "arguments": ["m1"]},
                { "name": "max", "arguments": ["m1"]},
                { "name": "count", "arguments": ["m1"]}
            ],
                
            "measures": ["m1"],
            
            "main_table_fields": ["dim1", "dim2"],
            
            "join_chains": {
                "dim2": {
                    "join_column": "id",
                    "table": "mydim",
                    "type": "inner",
                    "get_columns": ["col1"],
                    "condition": "equal"
                }
            }
        }
       }
     }
    }
   }